% standard LaTeX packages
\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage[margin=3cm]{geometry}
\usepackage[
  colorlinks = true,
  linkcolor = .,
  urlcolor  = blue,
  citecolor = blue!70!black,
  anchorcolor = .,
]{hyperref}
\usepackage{parskip}
\usepackage{xifthen,xparse}

% math packages
\usepackage{mathtools,amsfonts,amssymb,mathdots}
\usepackage{mathrsfs}
\usepackage{siunitx}
\usepackage{physics}
\usepackage{nicefrac}
\mathtoolsset{showonlyrefs}

\sisetup{
  range-phrase=--,
}

% plotting and tables
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepackage{caption}
\usepackage{cleveref}
\usepgfplotslibrary{external}
\tikzexternalize[prefix=tikz-,mode=list and make]
\usepgfplotslibrary{units}
\usepgfplotslibrary{groupplots}
\pgfplotsset{
  compat=1.13,
  scaled x ticks = false,
  x tick label style={
    /pgf/number format/fixed,
    /pgf/number format/1000 sep = \thinspace
  },
  scaled y ticks = false,
  y tick label style={
    /pgf/number format/fixed,
    /pgf/number format/1000 sep = \thinspace
  },
  legend cell align=left,
  % unit
  unit markings=slash space,
  unit code/.code 2 args=
    \expandafter\expandafter\expandafter\expandafter
    \expandafter\expandafter\expandafter\si
    \expandafter\expandafter\expandafter\expandafter
    \expandafter\expandafter\expandafter{#2},
  % legend style={
  %   at={(1.02,1)},
  %   anchor=north west,
  % },
  filter discard warning=false,
  unbounded coords=discard,
}

% other packages
% \usepackage{filecontents}
\usepackage{marginnote}
\usepackage{booktabs}

% bibliography packages
\usepackage[
  backend=bibtex8,
  style=authoryear,
  autocite=inline,
  sorting=nty,
  hyperref=true,
  maxcitenames=2,
]{biblatex}

% bibliography
\addbibresource{bibliography.bib}
\nocite{*}

% custom math commands
\newcommand\V[1]{\mathbf{#1}}                  % vector notation
\newcommand\M[1]{\begin{bmatrix} #1 \end{bmatrix}} % matrix shorthand

% commands for derivatives/integral dx expressions
\newcommand\D[1]{{\,\mathrm{d}{#1}}}
\renewcommand\dd[2][]{{%
  \ifthenelse{\isempty{#1}}%
    {\mathrm{d}{#2}}%
    {\mathrm{d}^{#1}{#2}}%
}}
\newcommand\df[3][]{{%
  \ifthenelse{\isempty{#1}}%
    {\frac{\mathrm{d}{#2}}{\mathrm{d}{#3}}}%
    {\frac{\mathrm{d}^{#1}{#2}}{{\mathrm{d}{#3}^{#1}}}}%
}}
\newcommand\pD[1]{{\,\mathrm{d}{#1}}}
\newcommand\pdd[2][]{{%
  \ifthenelse{\isempty{#1}}%
    {\parital{#2}}%
    {\partial^{#1}{#2}}%
}}
\newcommand\pdf[3][]{{%
  \ifthenelse{\isempty{#1}}%
    {\frac{\partial{#2}}{\partial{#3}}}%
    {\frac{\partial^{#1}{#2}}{{\partial{#3}^{#1}}}}%
}}

\def\M{\mathscr{M}}

\DeclareDocumentCommand{\reversemarginnote}{ m O{} }{\reversemarginpar\marginnote{#1}[#2]\reversemarginpar}
\newcommand\oppg[1]{\reversemarginnote{\textcolor{black!40}{#1)}}[2mm]}

\newcommand\comment[1]{\textcolor{red}{[#1]}}

\begin{document}

\title{Project 5 - FYS3150 Computational Physics}
\author{
  Fredrik Østrem (\texttt{fredost}) \\
    \href{https://github.com/frxstrem/fys3150/tree/master/project5}{\tt github.com/frxstrem/fys3150}
  \and
  Joseph Knutson (\texttt{josephkn}) \\
    \href{https://github.com/mathhat/Computational_Physics/tree/master/prosjekt5}{\tt github.com/mathhat/Computational\_Physics}
}
\date{\today}

\maketitle

\begin{abstract}
  \textit{Abstract}
\end{abstract}

\tableofcontents

\clearpage

\section{Introduction}
The aim of this project is to simulate transactions of money between financial
agents, people, using Monte Carlo methods. The final goal is to extract a distribution of
income as function of the income $m$. From Pareto’s work
\autocite{pareto},
and from empirical studies, it is known that the higher end of the distribution of money, rich end, follows a power distribution.
$$\omega_{m} = m^{-1-\alpha} $$
with $\alpha\in [1,2]$. We will follow the analysis made by
\textcite{patriarca}.

We assume we have $N$ agents that exchange money in pairs $(i,j)$. We assume also that all agents
start with the same amount of money $m_0 > 0$. At a given ``time step'', we choose a pair
of agents $(i,j)$ and let a transaction take place. This means that agent $i$'s money $m_i$ changes
to $m_i'$ and similarly we have $m_j\rightarrow m_j'$.
Money is conserved during a transaction:

\begin{equation}
  m_i+m_j=m_i'+m_j'.
  \label{eq:conserve}
\end{equation}
In order to decide which agent gets what, we draw a random number $\epsilon$.
The change is done via a random reassignement (a random number) $\epsilon$, meaning that

\begin{equation}
  m_i' = \epsilon(m_i+m_j), \label{eq:eps1}
\end{equation}
leading to

\begin{equation}
  m_j'= (1-\epsilon)(m_i+m_j). \label{eq:eps2}
\end{equation}
The number $\epsilon$ is extracted from a uniform distribution.
In this simple model, no agents are left with a debt, that is $m\ge 0$.
Due to the conservation law above, one can show that the system relaxes toward an equilibrium
state given by a Gibbs distribution
\begin{equation*}
  w_m=\beta \exp{(-\beta m)},
\end{equation*}
with
\begin{equation*}
  \beta = \frac{1}{\langle m\rangle},
\end{equation*}
and $\langle m\rangle=\sum_i m_i/N=m_0$, the average money.
It means that after equilibrium has been reached that the majority of agents is left with a small
number of money, while the number of richest agents, those with $m$ larger than a specific value $m'$,
exponentially decreases with $m'$.

In each simulation, we need a sufficiently large number of transactions, say $10^7$. Our aim is find the final equilibrium distribution $w_m$. In order to do that we would need
several runs of the above simulations, at least $10^3$--$10^4$ experiments.

\section{Theory of Models}

Now there are multiple models to explore. Our first model picks two entirely random agents, $i$ and $j$, and makes them trade a random amount decided by the factor $\epsilon$ (see equation \eqref{eq:eps1} and \eqref{eq:eps2}).
The following three models each add another parameter to the previous resulting in more realistic distributions of money.

\subsection{Second model: The Saving Factor $\lambda$} \label{sec:model2}
In our simplest model, nothing is stopping our agents from throwing away all their money. In order to make our agents a bit more rational, we will limit the amount of money they trade away.

The conservation law of \eqref{eq:conserve} holds, but the money to be shared in a transaction between
agent $i$ and agent $j$ is now $(1-\lambda)(m_i+m_j)$. This means that the amount of money our previous model would transfer is reduced by $\lambda$\%, which can be written as

\begin{equation}
  m_i'=m_i+\delta m
\end{equation}
and

\begin{equation}
  m_j'=m_j-\delta m,
\end{equation}
with

\begin{equation}\label{eq:save}
  \delta m=(1-\lambda)(\epsilon m_j-(1-\epsilon)m_i),
\end{equation}
From \eqref{eq:save}, if $\lambda = 0.8$, our agents will never trade more than 20\% of their total money.
As $\lambda$ goes to 1, our agents only engage in microtransactions. This reduces risk and you will soon see how helpful $\lambda$ can be for the reduction of poverty.

\subsection{Third model: The Preferential Factor $\alpha$} \label{sec:model3}
Our next model is the same as the last, except our agents will not only have risk reduction through $\lambda$, but also a preferred trading partner through $\alpha$.
How our agents will come to prefer each other will be based on how equal they are economically.
\begin{equation}\label{eq:alpha}
 P(i,j;\alpha) \propto \left|m(i)-m(j) \right|^{-\alpha}
\end{equation}
We use the expression in \eqref{eq:alpha} to produce a probability for agent $i$ and $j$'s transaction. We can't know what the proportionality constant is without
calculating the probability of every pair of agents (which is costly). Instead we generate a random number $r$ between $0$ and $S$, such that $S$ is larger than the probability expression
some large fraction of the time. We discard a transaction between pair of agents if $r$ is less than the probability expression in \eqref{eq:alpha}.
If $S$ is too small, any pair where the probability expression in \eqref{eq:alpha} is larger than $S$ will always be accepted, causing a less accurate distribution, while if $S$ is too large, too
many pairs of agents will be discarded, so computation time will take longer.

\subsection{Fourth model: Memory Factor $\gamma$} \label{sec:model4}
This time, we're adding another parameter to the way the agent's prefer trading with each other.
In real life, people build trust with those they've traded with before. We're going to make the agent's remember each other. The goal is to make them prefer those they've traded with before.
The more trades that a pair has comitted in past, the more likely it is for that pair to trade again in the future.

The new probability expression will contain a new factor:
\begin{equation}
 P(i,j;\alpha,\gamma) \propto \left|m(i)-m(j) \right|^{-\alpha}(C_{ij} + 1)^{\gamma}
\end{equation}
$C$ is a matrix which stores the amount of times that agent $i$ and $j$ have traded.
This means that each time agent $i$ and $j$ trades, $C_{ij}$ grows with 1.

We see that for $\gamma = 0$, the probability of a transaction is the same as before, but for
$\gamma > 0$ the probability of trade increases.

\clearpage

\section{Methods}

To model the trading between our agents, we use random sampling, the essence of Monte Carlo methods.
To complicate things further, we added probabilistic if-expressions to create preferential bonds between agents based on money and past transactions, requiring even more sampling.

To see if our simulations ever reach a form of equilibrium, we observe the variance of the agents' money. Doing so over time could prove useful for pinpointing when the distribution of money has stabilized.
\subsection{Monte Carlo}
All our simulations ran 10 million transactions for each of  the 1 thousand cycles. Each of the $10^3 \times 10^7$ transactions consist of drawing two random numbers, $i$ and $j$, representing two agents.
We have both used different random number generators to do this. Fredrik used the C++ random number generator, while Joseph used the C function \verb|rand()|.

$P(i,j;\alpha)$ and $P(i,j;\alpha,\gamma)$ were later calculated and compared to random samples between $0$ and $S$. This was in order to decide if agents $i$ and $j$ knew each other were economically equal from before.
\subsection{Variance and Equilibrium}
Variance shows the average squared difference between the people's actual wealth and their initial money, $m_0$. It doesn't tell if there is extreme poverty, but the larger it is the more inequality we will find.
To calculate it, we simply iterate over all our agents' money:s
\begin{equation}
\sigma_m^2 = \frac{1}{N}\sum_i^{N} (m_i - m_0)^2 = \expval{m^2} - \expval{m}^2 \label{eq:sigma}
\end{equation}
where $N$ equals the number of agent and $m_i$ is agent $i$'s money.
The variance between our agents' money is calculated between every transaction (see Results).

\clearpage

\section{Result}

In all our simulations, we run 1000 runs with $10^7$ transactions each.

\subsection{First model: No preference}

\oppg{a,b}
We start the simulation with the simplest model: Initial amount $m_0 = 1$ with no saving ($\lambda = 0$) and no preference for transaction partners ($\alpha = 0, \gamma = 0$). In this case, we expect the Gibbs distribution
\begin{equation}
  w_m = \beta \exp(-\beta m)
\end{equation}
where $\beta = \expval{m}^{-1} = m_0^{-1}$.

In fact, when we run the simulations, we get the distribution shown in \cref{fig:a}, we see that the distribution matches almost exactly up with the distribution be would expect, where $\beta = m_0^{-1} = 1$. This is further comfirmed by plotting the $y$ axis logarithmically, in which case we get \cref{fig:b}, which clearly shows this relation.

We know that the variance of the Gibbs distribution is $\sigma_m^2 = \beta^{-2} = m_0^2$, and we can use this to find out how many transactions we need to get equalibrium. Before any transactions, the variance is zero (as every agent has the same amount of money); after equalibrium is reached, we expect the variance to vary around the theoretical variance.
In \cref{fig:a-equalibrium} we see the calculated variance of the simulated distribution plotted against the number of transactions, for different number of agents. We can see that it takes only about \numrange{e2}{e3} transactions to reach equalibrium, and that this number is roughly proportional to $N$.

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
        width=1.0\textwidth,
        height=0.5\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=6,
        xtick={0,1,...,6},
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=0, ymax=0.01,
        ytick={0,1e-3,2e-3,3e-3,4e-3,5e-3,6e-3,7e-3,8e-3,9e-3,10e-3},
        y tick label style={
          /pgf/number format/fixed,
          /pgf/number format/fixed zerofill,
          /pgf/number format/precision=3,
          /pgf/number format/1000 sep = \thinspace
        },
      ]
      \addplot+[ybar interval,forget plot,draw=none,fill=blue!30,no marks] table[x=m_start,y=relcount] {data/5a-N500.dat};
        \addlegendimage{blue!30}
        \addlegendentry{Simulation}

      \addplot[red,thick,domain=0:10,samples=100] {0.01 * exp(-x)};
        \addlegendentry{$\Delta{m} \, e^{-x}$}
    \end{axis}
  \end{tikzpicture}

  \caption{Histogram of the distribution of wealth after running the simple model ($\lambda = 0, \alpha = 0, \gamma = 0$) with \num{e7} transactions \num{e3} times, compared with the theoretical Gibbs distribution. Bin width is $\Delta{m} = 0.01$.} \label{fig:a}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
        width=1.0\textwidth,
        height=0.5\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=10,
        xtick={0,1,...,10},
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=1e-7, ymax=1e-2,
        ymode=log,
      ]
      \addplot[blue!30,forget plot] table[x=m_start,y=relcount] {data/5a-N500.dat};
        \addlegendimage{blue!30}
        \addlegendentry{Simulation}

      \addplot[red,thick,domain=0:10,samples=100] {0.01 * exp(-x)};
        \addlegendentry{$\Delta{m} \, e^{-x}$}

      \addplot[black,dotted,forget plot,domain=0:10,samples=2] {1 / 500000};
    \end{axis}
  \end{tikzpicture}

  \caption{The distribution from \cref{fig:a}, plotted on a logarithmic $y$ axis.} \label{fig:b}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
        legend style={
          at={(0.01,0.98)},
          anchor=north west,
        },
        width=1.0\textwidth,
        height=0.5\textwidth,
        xlabel={Number of transactions},
        xmin=1e0, xmax=1e7,
        xmode=log,
        ylabel={Variance},
        ymin=0, ymax=3,
      ]
      \addplot[blue] table[x=k,y=V] {data/5a-equalibrium-100.dat};
        \addlegendentry{variance ($ N = 100 $)}

      \addplot[purple] table[x=k,y=V] {data/5a-equalibrium-250.dat};
        \addlegendentry{variance ($ N = 250 $)}
      \addplot[red] table[x=k,y=V] {data/5a-equalibrium-500.dat};
        \addlegendentry{variance ($ N = 500 $)}
      \addplot[orange] table[x=k,y=V] {data/5a-equalibrium-1000.dat};
        \addlegendentry{variance ($ N = 1000 $)}

      \addplot[black,dashed,domain=1:1e7,samples=2] {1};
        \addlegendentry{Ideal variance $V = m_0^2$}
    \end{axis}
  \end{tikzpicture}

  \caption{Simulated distribution variance as a function of number of transactions, for different numbers of agents. Dashed black line marks the ``ideal'' variance (theoretical variance at equalibrium).} \label{fig:a-equalibrium}
\end{figure}

\subsection{Second model: The Saving Factor $\lambda$}

\clearpage
\oppg{c}
Next, we introduce saving into the equation: every time a transaction happens, each of the agents save a fraction $\lambda$ before each transaction (as described in \cref{sec:model2}). We run three simulations with saving fractions $\lambda = 0.25, 0.50, 0.90$, and look at how these alter the distribution of money. In \cref{fig:c} we see the distributions of these simulations. We see that having a high saving fractions lowers lowers wealth inequality, and at very high saving fractions ($\lambda = 0.90$), the money is distributed according to an approximate narrow Gaussian distribution centered at $m_0 = 1$.

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
        width=\textwidth,
        height=0.5\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=6,
        xtick={0,1,...,6},
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=0, ymax=0.03,
        ytick={0,0.005,...,0.030,0.030},
        y tick label style={
          /pgf/number format/fixed,
          /pgf/number format/fixed zerofill,
          /pgf/number format/precision=3,
          /pgf/number format/1000 sep = \thinspace
        },
      ]
      \addplot[black] table[x=m_start,y=relcount] {data/5a-N500.dat};
        \addlegendentry{$\lambda = 0.00$}

      \addplot[blue] table[x=m_start,y=relcount] {data/5c-N500-l0.25.dat};
        \addlegendentry{$\lambda = 0.25$}

      \addplot[red] table[x=m_start,y=relcount] {data/5c-N500-l0.50.dat};
        \addlegendentry{$\lambda = 0.50$}

      \addplot[purple] table[x=m_start,y=relcount] {data/5c-N500-l0.90.dat};
        \addlegendentry{$\lambda = 0.90$}
    \end{axis}
  \end{tikzpicture}

  \caption{Simulated distributions after we introduce a saving fraction $\lambda$ in the model.} \label{fig:c}
\end{figure}

\subsection{Third model: The Preferential Factor $\alpha$}
\oppg{d}

We then introduce a new parameter $\alpha$, that affects the agents preference for transaction partners with wealth close to their own (as described in \cref{sec:model3}). We run eight new simulations with parameters $\lambda = 0.00,0.25$ and $\alpha = 0.5,1.0,1.5,2.0$ for $N = 500$ and $N = 1000$.

In \cref{fig:d-N500,fig:d-N1000} we see the wealth distributions of these models. From these distributions we can tell that a higher value of $\alpha$ will cause more people to have less money, giving a more narrow distribution and less wealth inequality among agents.

In \cref{fig:d-log}, we have plotted the same data for $N = 100$ with logarithmic axes.
We expect this plot to be similar to figure~1 of \textcite{goswami-sen}. Indeed, our plot is very similar, except that our plot does not reproduce the kink at $m \approx \num{2e-2}$ for the larger $\alpha$ values.

If the distribution followed a tail power law, we would expect the plots in \cref{fig:d-log} to make a straight line in the tail. Instead

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=10pt,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=2,
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=0, ymax=0.035,
        ytick={0,0.005,...,0.030,0.030},
        y tick label style={
          /pgf/number format/fixed,
          /pgf/number format/fixed zerofill,
          /pgf/number format/precision=3,
          /pgf/number format/1000 sep = \thinspace
        },
      ]

      \nextgroupplot[]
        \addplot[black,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5a-N500.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 0.0$}
        \addplot[blue,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a0.5.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 0.5$}
        \addplot[purple,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a1.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0$}
        \addplot[red,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a1.5.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.5$}
        \addplot[orange,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a2.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 2.0$}

      \nextgroupplot[]
        \addplot[black,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5c-N500-l0.25.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 0.0$}
        \addplot[blue,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a0.5.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 0.5$}
        \addplot[purple,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a1.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0$}
        \addplot[red,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a1.5.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.5$}
        \addplot[orange,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a2.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 2.0$}
    \end{groupplot}
  \end{tikzpicture}

  \caption{Simulated distributions after a ``wealth preference'' parameter $\alpha$ is introduced into the model. Number of agents is $N = 500$.} \label{fig:d-N500}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=10pt,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=2,
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=0, ymax=0.035,
        ytick={0,0.005,...,0.030,0.030},
        y tick label style={
          /pgf/number format/fixed,
          /pgf/number format/fixed zerofill,
          /pgf/number format/precision=3,
          /pgf/number format/1000 sep = \thinspace
        },
      ]

      \nextgroupplot[]
        % \addplot[black,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5a-N500.dat};
        %   \addlegendentry{$\lambda = 0.00, \alpha = 0.0$}
        \addplot[blue,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.00-a0.5.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 0.5$}
        \addplot[purple,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.00-a1.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0$}
        \addplot[red,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.00-a1.5.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.5$}
        \addplot[orange,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.00-a2.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 2.0$}

      \nextgroupplot[]
        % \addplot[black,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5c-N500-l0.25.dat};
        %   \addlegendentry{$\lambda = 0.25, \alpha = 0.0$}
        \addplot[blue,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.25-a0.5.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 0.5$}
        \addplot[purple,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.25-a1.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0$}
        \addplot[red,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.25-a1.5.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.5$}
        \addplot[orange,restrict x to domain=0:2] table[x=m_start,y=relcount] {data/5d-N1000-l0.25-a2.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 2.0$}
    \end{groupplot}
  \end{tikzpicture}

  \caption{Same as \cref{fig:d-N500}, but with $N = 1000$ agents.} \label{fig:d-N1000}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=10pt,
        },
        legend style={
          at={(0.01,0.02)},
          anchor=south west,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmode=log,
        xmin=0.01, xmax=100,
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymode=log,
        ymin=2e-6, ymax=1,
      ]

      \nextgroupplot[]
        \addplot[black] table[x=m_start,y=relcount] {data/5a-N500.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 0.0$}
        \addplot[blue] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a0.5.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 0.5$}
        \addplot[purple] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a1.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0$}
        \addplot[red] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a1.5.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.5$}
        \addplot[orange] table[x=m_start,y=relcount] {data/5d-N500-l0.00-a2.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 2.0$}

      \nextgroupplot[]
        \addplot[black] table[x=m_start,y=relcount] {data/5c-N500-l0.25.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 0.0$}
        \addplot[blue] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a0.5.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 0.5$}
        \addplot[purple] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a1.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0$}
        \addplot[red] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a1.5.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.5$}
        \addplot[orange] table[x=m_start,y=relcount] {data/5d-N500-l0.25-a2.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 2.0$}

    \end{groupplot}
  \end{tikzpicture}

  \caption{Same data as in \cref{fig:d-N500}, plotted with logarithmic axes.} \label{fig:d-log}
\end{figure}

\clearpage
\subsection{Fourth model: Memory Factor $\gamma$} \label{sec:model4}
\oppg{e}

Finally, we introduce the parameter $\gamma$ that affects the agents preference for previous transaction partners (as described in \cref{sec:model4}). We run 20 simulations with parameters $\lambda = 0.00, 0.25$, $\alpha = 1.0, 2.0$ and $\gamma = 0.0, 1.0, 2.0, 3.0, 4.0$, with $N = 1000$ agents.

In \cref{fig:e-nosave,fig:e-save,fig:e-nosave-log,fig:e-save-log}, wave have again plotted the distributions of these simulations with linear and logarithmic axes.
By looking at these figures, we see that increasing the $\gamma$ parameter ``evens out'' the distribution again. If we compare this to the distributions of differing $\alpha$ values in \cref{fig:d-N1000}, we see that $\gamma$ parameters in effect ``negate'' the effects of the $\alpha$ parameter.

If we compare the figures without saving (\cref{fig:e-nosave-log}) with figures~5~and~6 of \textcite{goswami-sen}, we see that for $\alpha = 1.0$ the plots have a similar shape, while for $\alpha = 2.0$ the plots are drastically different.
For $m$ between approximately 2 and 20, we see that the distribution stays approximately uniform.

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=15pt,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=1,
        xtick={0,0.5,1,1.5,2},
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=0, ymax=0.1,
        % ytick={0,0.005,...,0.030,0.030},
        y tick label style={
          /pgf/number format/fixed,
          /pgf/number format/fixed zerofill,
          /pgf/number format/precision=3,
          /pgf/number format/1000 sep = \thinspace
        },
      ]

      \nextgroupplot[]
        \addplot[blue,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g0.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 0.0$}
        \addplot[purple,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g1.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 1.0$}
        \addplot[red,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g2.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 2.0$}
        \addplot[orange,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g3.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 3.0$}
        \addplot[yellow,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g4.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 4.0$}

        \nextgroupplot[]
          \addplot[blue,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g0.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 0.0$}
          \addplot[purple,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g1.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 1.0$}
          \addplot[red,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g2.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 2.0$}
          \addplot[orange,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g3.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 3.0$}
          \addplot[yellow,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g4.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 4.0$}

    \end{groupplot}
  \end{tikzpicture}

  \caption{Simulated distributions after a ``agent preference'' parameter $\gamma$ is introduced into the model, with no savings ($\lambda = 0$). Number of agents is $N = 1000$.} \label{fig:e-nosave}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=15pt,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmin=0, xmax=1,
        xtick={0,0.5,1,1.5,2},
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymin=0, ymax=0.1,
        % ytick={0,0.005,...,0.030,0.030},
        y tick label style={
          /pgf/number format/fixed,
          /pgf/number format/fixed zerofill,
          /pgf/number format/precision=3,
          /pgf/number format/1000 sep = \thinspace
        },
      ]

      \nextgroupplot[]
        \addplot[blue,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g0.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 0.0$}
        \addplot[purple,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g1.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 1.0$}
        \addplot[red,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g2.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 2.0$}
        \addplot[orange,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g3.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 3.0$}
        \addplot[yellow,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g4.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 4.0$}

        \nextgroupplot[]
          \addplot[blue,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g0.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 0.0$}
          \addplot[purple,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g1.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 1.0$}
          \addplot[red,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g2.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 2.0$}
          \addplot[orange,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g3.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 3.0$}
          \addplot[yellow,restrict x to domain=0:1] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g4.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 4.0$}

    \end{groupplot}
  \end{tikzpicture}

  \caption{Simulated distributions after a ``agent preference'' parameter $\gamma$ is introduced into the model, with savings ($\lambda = 0.25$). Number of agents is $N = 1000$.} \label{fig:e-save}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=15pt,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmode=log,
        xmin=0.01, xmax=100,
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymode=log,
        ymin=2e-7, ymax=1,
      ]

      \nextgroupplot[]
        \addplot[blue] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g0.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 0.0$}
        \addplot[purple] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g1.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 1.0$}
        \addplot[red] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g2.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 2.0$}
        \addplot[orange] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g3.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 3.0$}
        \addplot[yellow] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a1.0-g4.0.dat};
          \addlegendentry{$\lambda = 0.00, \alpha = 1.0, \gamma = 4.0$}

        \nextgroupplot[]
          \addplot[blue] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g0.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 0.0$}
          \addplot[purple] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g1.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 1.0$}
          \addplot[red] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g2.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 2.0$}
          \addplot[orange] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g3.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 3.0$}
          \addplot[yellow] table[x=m_start,y=relcount] {data/5e-N1000-l0.00-a2.0-g4.0.dat};
            \addlegendentry{$\lambda = 0.00, \alpha = 2.0, \gamma = 4.0$}

    \end{groupplot}
  \end{tikzpicture}

  \caption{Same as \cref{fig:e-nosave} (without saving), plotted with logarithmic axes.} \label{fig:e-nosave-log}
\end{figure}

\begin{figure}[!ht]
  \centering
  \begin{tikzpicture}
    \begin{groupplot}[
        group style={
          group size=1 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          ylabels at=edge left,
          yticklabels at=edge left,
          vertical sep=15pt,
        },
        width=\textwidth,
        height=0.8\textwidth,
        xlabel={Money $m$ (in intervals of $\Delta{m} = 0.01$)},
        xmode=log,
        xmin=0.01, xmax=100,
        ylabel={Relative frequencies $w_m \Delta{m}$},
        ymode=log,
        ymin=2e-7, ymax=1,
      ]

      \nextgroupplot[]
        \addplot[blue] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g0.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 0.0$}
        \addplot[purple] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g1.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 1.0$}
        \addplot[red] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g2.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 2.0$}
        \addplot[orange] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g3.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 3.0$}
        \addplot[yellow] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a1.0-g4.0.dat};
          \addlegendentry{$\lambda = 0.25, \alpha = 1.0, \gamma = 4.0$}

        \nextgroupplot[]
          \addplot[blue] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g0.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 0.0$}
          \addplot[purple] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g1.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 1.0$}
          \addplot[red] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g2.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 2.0$}
          \addplot[orange] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g3.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 3.0$}
          \addplot[yellow] table[x=m_start,y=relcount] {data/5e-N1000-l0.25-a2.0-g4.0.dat};
            \addlegendentry{$\lambda = 0.25, \alpha = 2.0, \gamma = 4.0$}

    \end{groupplot}
  \end{tikzpicture}

  \caption{Same as \cref{fig:e-save} (with saving), plotted with logarithmic axes.} \label{fig:e-save-log}
\end{figure}

\clearpage

\appendix
\section{Appendix}

\comment{where can code etc. be found?}

\printbibliography[heading=bibnumbered,title=Bibliography]

\end{document}
